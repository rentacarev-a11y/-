<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>국내 재고 리스트 (샘플: 현대 정상재고)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --card:#ffffff;
      --line:rgba(15,23,42,.12);
      --text:#0f172a;
      --muted:rgba(15,23,42,.65);
      --accent:#e60012;
      --accent2:#2563eb;
      --shadow: 0 10px 24px rgba(15,23,42,.08);
      --radius:14px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(91,140,255,.22), transparent 50%),
                  radial-gradient(900px 700px at 90% 10%, rgba(56,217,169,.16), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family:var(--font);
    }

    .wrap{max-width:1200px; margin:0 auto; padding:22px 16px 28px;}

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,.88);
      border-bottom:1px solid var(--line);
    }
    .topbar{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:14px 16px; max-width:1200px; margin:0 auto;}
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:34px; height:34px; border-radius:10px;
      background: linear-gradient(135deg, rgba(91,140,255,.95), rgba(56,217,169,.9));
      box-shadow: 0 10px 22px rgba(91,140,255,.18);
    }
    .title{line-height:1.1}
    .title h1{font-size:15px; margin:0; font-weight:800; letter-spacing:-.2px}
    .title p{margin:2px 0 0; font-size:12px; color:var(--muted)}

    .right{display:flex; gap:10px; align-items:center;}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 10px; border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      box-shadow: var(--shadow);
    }
    .pill input{
      width:min(340px, 48vw);
      border:none; outline:none; background:transparent; color:var(--text);
      font-size:13px;
    }
    .pill input::placeholder{color:rgba(232,236,255,.48)}

    .chipbar{display:flex; flex-wrap:wrap; gap:8px; padding:0 16px 14px; max-width:1200px; margin:0 auto;}

    .chip{
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      padding:9px 11px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition:.15s;
      display:inline-flex; align-items:center; gap:8px;
    }
    .chip:hover{transform: translateY(-1px); border-color: rgba(91,140,255,.35); color:var(--text)}
    .chip.active{background: rgba(91,140,255,.18); border-color: rgba(91,140,255,.55); color:var(--text)}

    .section-title{margin:16px 0 10px; display:flex; gap:10px; align-items:flex-end; justify-content:space-between}
    .section-title h2{margin:0; font-size:14px; letter-spacing:-.2px}
    .meta{color:var(--muted); font-size:12px}

    .grid{display:grid; grid-template-columns: 1fr; gap:10px;}

    .row{
      display:grid;
      grid-template-columns: 56px 1.4fr 1.6fr 1.2fr 140px 220px 140px;
      gap:10px;
      align-items:center;
      padding:12px 12px;
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .row:hover{border-color: rgba(91,140,255,.32)}

    .no{color:rgba(232,236,255,.70); font-weight:700; text-align:center; font-variant-numeric: tabular-nums;}

    .main{
      min-width:0;
    }
    .maker{font-size:11px; color:rgba(232,236,255,.62);}
    .model{font-size:14px; font-weight:800; letter-spacing:-.2px; margin-top:2px; white-space:normal; overflow:visible; text-overflow:clip;}

    .sub{
      min-width:0;
      color:rgba(232,236,255,.82);
      font-size:12px;
      white-space:normal;
      overflow:visible;
      text-overflow:clip;
    }

    .price{font-variant-numeric: tabular-nums; font-weight:800; text-align:right;}
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(56,217,169,.12);
      border:1px solid rgba(56,217,169,.35);
      color: rgba(56,217,169, .95);
      font-size:12px;
      font-weight:800;
      font-variant-numeric: tabular-nums;
    }

    .btn{
      border:none;
      background: rgba(91,140,255,.18);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      white-space:nowrap;
      cursor:pointer;
      font-weight:800;
      letter-spacing:-.2px;
      border:1px solid rgba(91,140,255,.35);
      transition:.15s;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(91,140,255,.6)}

    .toast{
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 18px;
      background: rgba(255,255,255,.96);
      border:1px solid var(--line);
      padding:10px 12px;
      border-radius: 12px;
      white-space:nowrap;
      box-shadow: var(--shadow);
      color: rgba(232,236,255,.92);
      font-size:12px;
      display:none;
      z-index: 100;
    }

    .listwrap{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background:#fff;
    }

    .scroll-area{
      max-height: calc(100vh - 240px);
      overflow: auto;
      padding-right: 4px;
      scrollbar-width: none; /* Firefox */
    }
    .scroll-area::-webkit-scrollbar{width:0;height:0;} /* Chrome */

    .empty{
      padding: 26px 12px;
      text-align:center;
      color: rgba(232,236,255,.72);
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 14px;
    }

    
    .logoImg{width:140px; height:34px; object-fit:contain;}
    .divider{max-width:1200px;margin:0 auto;border-top:1px solid var(--line)}
    .searchRow{max-width:1200px;margin:0 auto; padding:0 16px 12px}
    .searchInput{width:100%; border:1px solid var(--line); background:#fff; padding:12px 14px; border-radius:14px; font-size:14px; outline:none}
    .searchInput:focus{border-color: rgba(230,0,18,.45); box-shadow: 0 0 0 3px rgba(230,0,18,.10)}
    .modelHeader{max-width:1200px;margin:0 auto; padding:10px 16px 8px; display:flex; align-items:center; justify-content:space-between; gap:10px}
    .modelTitle{font-size:12px; color:var(--muted); font-weight:800}
    .toggleBtn{border:1px solid var(--line); background:#fff; padding:7px 10px; border-radius:10px; cursor:pointer; font-weight:800}
    .toggleBtn:hover{border-color: rgba(15,23,42,.25)}
    .colorChip{display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#fff; font-size:11px; color:var(--muted);}
    .matchTag{display:inline-flex; align-items:center; padding:3px 8px; border-radius:999px; margin-left:6px; border:1px solid rgba(230,0,18,.25); background: rgba(230,0,18,.06); color: var(--accent); font-weight:900; font-size:11px;}


    @media (max-width: 900px){
      .row{grid-template-columns: 42px 1fr; grid-auto-rows:auto}
      .sub, .price, .badge, .btn{grid-column: 2 / -1}
      .price{text-align:left}
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <img class="logoImg" src="https://sspark.genspark.ai/cfimages?u1=rstie8J659kYe%2F3rw%2BRWdFw7pFwBtLCwVzPwcaVZ3L6c7k3MGQYbBrPiHbEx9CbpvFmNd%2FWdeTRpCqyid%2FNRceiaKL8ogK2tHUeY91BPXwOVStrAihTejnvl%2FxjBpNTQ%2FSS0MUTDxMLe&u2=JyaSnzY08g7HjH92&width=512" alt="롯데렌터카 로고" />
        <div class="title">
          <h1>롯데렌터카 전략구매 재고리스트 / 현대자동차, 기아 재고확보 리스트</h1>
          <p>전략구매 우선 노출 · 정상재고 · 텍스트복사</p>
        </div>
      </div>

      </div>

    <div class="chipbar" id="makerBar">
      <div class="chip active" data-maker="ALL">전체</div>
      <div class="chip" data-maker="LOTTE">롯데렌터카(전략구매)</div>
      <div class="chip" data-maker="HYUNDAI">현대자동차</div>
      <div class="chip" data-maker="KIA">기아</div>
      <div class="chip" data-maker="KGM">KGM</div>
      <div class="chip" data-maker="RENAULT">르노</div>
      <div class="chip" data-maker="CHEVROLET">쉐보레</div>
    </div>

    <div class="searchRow">
      <input id="q" class="searchInput" placeholder="검색: 차종, 옵션(트림), 색상" autocomplete="off" />
    </div>

    <div class="divider"></div>

    <div class="modelHeader">
      <div class="modelTitle">차종 필터</div>
      <button class="toggleBtn" id="toggleModels">접기</button>
    </div>

    <div class="chipbar" id="modelBar" style="padding-top:0"></div>
  </header>

  <main class="wrap">
    <div class="section-title">
      <h2>리스트</h2>
      <div class="meta" id="meta">로딩중…</div>
    </div>

    <div class="listwrap">
      <div class="scroll-area" id="scrollArea">
        <div class="grid" id="list"></div>
        <div id="sentinel" style="height:14px"></div>
      </div>
    </div>

    <div style="height:18px"></div>

    <div class="meta">
      팁) ‘텍스트복사’는 차종+옵션+색상+가격+정상재고 정보를 한 번에 복사합니다.
    </div>
  </main>

  <div class="toast" id="toast"></div>

<script>
  // ====== 데이터 소스 (정적) ======
  // 지금은 현대 샘플만 포함. 추후:
  // - lotte_strategy.json (전략구매)
  // - kia_normal.json 등 추가
  const DATA_SOURCES = [
    { key: 'HYUNDAI', name: '현대자동차', url: './hyundai_normal.json', priority: 2 },
    { key: 'LOTTE', name: '롯데렌터카(전략구매)', url: './lotte_strategy.json', priority: 1 },
    { key: 'KIA', name: '기아', url: './kia_normal.json', priority: 3 },
    { key: 'KGM', name: 'KGM', url: './kgm_normal.json', priority: 3 },
    { key: 'RENAULT', name: '르노', url: './renault_normal.json', priority: 3 },
    { key: 'CHEVROLET', name: '쉐보레', url: './chevrolet_normal.json', priority: 3 },
  ];

  // ====== 상태 ======
  let all = [];        // 모든 레코드
  let lotteModelSet = new Set();
  let filtered = [];   // 필터 후
  let rendered = 0;
  const PAGE = 60;

  let makerFilter = 'ALL';
  let modelFilter = 'ALL';

  const elList = document.getElementById('list');
  const elMeta = document.getElementById('meta');
  const elQ = document.getElementById('q');
  const elToast = document.getElementById('toast');
  const elMakerBar = document.getElementById('makerBar');
  const elModelBar = document.getElementById('modelBar');
  const elScrollArea = document.getElementById('scrollArea');

  function showToast(msg){
    elToast.textContent = msg;
    elToast.style.display = 'block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> elToast.style.display='none', 1200);
  }

  function money(n){
    if(n===null || n===undefined || n==='') return '-';
    try{ return Number(n).toLocaleString('ko-KR'); }catch{ return String(n); }
  }

  function colorChips(colorText){
    const s = safeText(colorText);
    const parts = s.split(/\s*\/\s*/).map(x=>x.trim()).filter(Boolean);
    const wrap = document.createElement('div');
    wrap.style.display='flex';
    wrap.style.flexWrap='wrap';
    wrap.style.gap='6px';
    for(const p of parts){
      const chip=document.createElement('span');
      chip.className='colorChip';
      chip.textContent=p;
      wrap.appendChild(chip);
    }
    return wrap;
  }

  function safeText(v){
    if(v===null || v===undefined) return '';
    return String(v).replace(/\s+/g,' ').trim();
  }

  // 차종 버튼명 정리: 시트명에서 불필요한 텍스트 제거
  function normalizeModelName(name){
    let s = safeText(name);
    s = s.replace(/\(.*?\)/g,'');
    s = s.replace(/\s*\+.*$/g,'');
    s = s.replace(/\s+/g,' ').trim();
    return s;
  }

  // 우선순위 정렬: 롯데 전략구매(1) → (없으면) 현대/기아 등(2~)
  function sortByPriorityThenModel(a,b){
    if(a.sourcePriority !== b.sourcePriority) return a.sourcePriority - b.sourcePriority;
    // 차종명
    const am = a.modelNorm.localeCompare(b.modelNorm, 'ko');
    if(am !== 0) return am;
    // 가격(낮은 순)
    return (a.price||0) - (b.price||0);
  }

  async function loadAll(){
    const loaded = [];
    for(const src of DATA_SOURCES){
      try{
        const res = await fetch(src.url, {cache: 'no-store'});
        if(!res.ok) throw new Error('missing');
        const arr = await res.json();
        for(const r of arr){
          loaded.push({
            ...r,
            sourceKey: src.key,
            sourceName: src.name,
            sourcePriority: src.priority,
            modelNorm: normalizeModelName(r.model ?? r.model_name ?? r.car_model ?? ''),
            makerNorm: (r.maker || src.name || '').includes('롯데') ? 'LOTTE'
                      : (r.maker || '').includes('현대') ? 'HYUNDAI'
                      : src.key,
          });
        }
      }catch(e){
        // 파일이 아직 없으면 무시 (추후 추가될 데이터)
      }
    }

    // 기본값: 현재는 현대 정상재고만 로드됨
    lotteModelSet = new Set(loaded.filter(x=>x.makerNorm==='LOTTE').map(x=>x.modelNorm));

    all = loaded.sort(sortByPriorityThenModel);

    // 차종 버튼 만들기(현재 선택된 메이커 기준)
    buildModelChips();

    applyFilters();
  }

  function buildModelChips(){
    const set = new Set();
    for(const r of all){
      if(makerFilter !== 'ALL' && r.makerNorm !== makerFilter) continue;
      set.add(r.modelNorm || '기타');
    }
    const models = Array.from(set).sort((a,b)=>a.localeCompare(b,'ko'));

    elModelBar.innerHTML = '';
    const allChip = document.createElement('div');
    allChip.className = 'chip' + (modelFilter==='ALL' ? ' active' : '');
    allChip.dataset.model = 'ALL';
    allChip.textContent = '차종 전체';
    elModelBar.appendChild(allChip);

    for(const m of models){
      const c = document.createElement('div');
      c.className = 'chip' + (modelFilter===m ? ' active' : '');
      c.dataset.model = m;
      c.textContent = m;
      elModelBar.appendChild(c);
    }
  }

  function applyFilters(){
    const q = safeText(elQ.value).toLowerCase();

    filtered = all.filter(r => {
      if(makerFilter !== 'ALL' && r.makerNorm !== makerFilter) return false;
      if(modelFilter !== 'ALL' && (r.modelNorm||'') !== modelFilter) return false;
      // 정상재고만: 현대 JSON은 이미 normal_total>0만 만들었지만, 방어적으로 체크
      if(typeof r.normal_total === 'number' && r.normal_total <= 0) return false;

      if(!q) return true;
      const hay = [r.sourceName, r.maker, r.modelNorm, r.trim_options, r.color, r.sales_code, r.color_code]
        .map(safeText).join(' | ').toLowerCase();
      return hay.includes(q);
    }).sort(sortByPriorityThenModel);

    rendered = 0;
    elList.innerHTML = '';
    renderMore(true);

    const total = filtered.length;
    elMeta.textContent = `총 ${total.toLocaleString('ko-KR')}건 (현재 ${Math.min(total, rendered).toLocaleString('ko-KR')}건 표시)`;
    if(total===0){
      elList.innerHTML = `<div class="empty">조건에 맞는 재고가 없습니다.</div>`;
    }
  }

  function makeCopyText(r){
    const maker = safeText(r.maker || r.sourceName || '');
    const model = safeText(r.modelNorm || r.model || '');
    const opt = safeText(r.trim_options || '');
    const color = safeText(r.color || '');
    const price = r.price!=null ? money(r.price) + '원' : '-';
    const total = (r.normal_total!=null) ? `${r.normal_total}대` : '-';

    // A 포맷 (한 줄)
    // “가격/정상합”는 항상 포함. 출고지별 정상은 괄호로 간단히.
    let loc = '';
    if(r.normal_by_location && typeof r.normal_by_location === 'object'){
      const parts = Object.entries(r.normal_by_location)
        .map(([k,v])=> `${k} ${v}`);
      if(parts.length) loc = ` | 출고지(정상): ${parts.join(', ')}`;
    }

    let extra = '';
    if(r.makerNorm==='LOTTE'){
      const now2 = (r.strategy_now!=null) ? `${r.strategy_now}대` : '-';
      const later2 = (r.strategy_later!=null) ? `${r.strategy_later}대` : '-';
      const total2 = (r.strategy_total!=null) ? `${r.strategy_total}대` : '-';
      extra = ` | 전략구매(즉시/미출고/총): ${now2}/${later2}/${total2}`;
    }
    return `${maker} | ${model} | 옵션: ${opt || '-'} | 색상: ${color || '-'} | 가격: ${price} | 정상재고합: ${total}${loc}${extra}`;
  }

  function rowTemplate(r, idx){
    const div = document.createElement('div');
    div.className = 'row';

    const no = document.createElement('div');
    no.className = 'no';
    no.textContent = String(idx + 1);

    const main = document.createElement('div');
    main.className = 'main';
    main.innerHTML = `<div class="maker">${safeText(r.maker || r.sourceName || '')}${(r.makerNorm!=='LOTTE' && lotteModelSet.has(r.modelNorm)) ? ' · <span class=\"matchTag\">카메이커 정상재고</span>' : ''}</div>
                      <div class="model">${safeText(r.modelNorm)}</div>`;

    const opt = document.createElement('div');
    opt.className = 'sub';
    opt.title = safeText(r.trim_options || '');
    opt.textContent = safeText(r.trim_options || '-')

    const color = document.createElement('div');
    color.className = 'sub';
    color.title = safeText(r.color || '');
    color.textContent = safeText(r.color || '-')
    const chips = colorChips(r.color||'');
    if(chips.childNodes.length) {
      chips.style.marginTop='6px';
      color.appendChild(chips);
    }

    const price = document.createElement('div');
    price.className = 'price';
    price.textContent = r.price!=null ? money(r.price) + '원' : '-';

    const badge = document.createElement('div');
    if(r.makerNorm==='LOTTE') {
      badge.innerHTML = `<span class=\"badge\">판매가능 ${r.strategy_now ?? 0}대</span> <span class=\"badge\" style=\"margin-left:6px; border-color: rgba(37,99,235,.35); color:#2563eb; background: rgba(37,99,235,.08);\">입고 ${r.strategy_later ?? 0}대</span>`;
    } else {
      badge.innerHTML = `<span class=\"badge\">정상 ${r.normal_total ?? '-'}대</span>`;
    }

    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.textContent = '텍스트복사';
    btn.addEventListener('click', async ()=>{
      const text = makeCopyText(r);
      try{
        await navigator.clipboard.writeText(text);
        showToast('복사 완료');
      }catch(e){
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        showToast('복사 완료');
      }
    });

    div.appendChild(no);
    div.appendChild(main);
    div.appendChild(opt);
    div.appendChild(color);
    div.appendChild(price);
    div.appendChild(badge);
    div.appendChild(btn);

    return div;
  }

  function renderMore(fromTop=false){
    if(fromTop) elScrollArea.scrollTop = 0;

    const total = filtered.length;
    const next = Math.min(total, rendered + PAGE);
    for(let i=rendered; i<next; i++){
      elList.appendChild(rowTemplate(filtered[i], i));
    }
    rendered = next;
    elMeta.textContent = `총 ${total.toLocaleString('ko-KR')}건 (현재 ${rendered.toLocaleString('ko-KR')}건 표시)`;
  }

  // 무한 스크롤 (IntersectionObserver)
  const io = new IntersectionObserver(entries => {
    if(entries.some(e => e.isIntersecting)){
      if(rendered < filtered.length) renderMore(false);
    }
  }, {root: elScrollArea, threshold: 0.5});

  io.observe(document.getElementById('sentinel'));

  // 메이커 탭
  elMakerBar.addEventListener('click', (e)=>{
    const chip = e.target.closest('.chip');
    if(!chip) return;
    makerFilter = chip.dataset.maker;
    for(const c of elMakerBar.querySelectorAll('.chip')) c.classList.toggle('active', c===chip);

    // 메이커 바뀌면 차종 필터 초기화 + 차종칩 재생성
    modelFilter = 'ALL';
    buildModelChips();
    // 차종바 active 처리
    const first = elModelBar.querySelector('.chip[data-model="ALL"]');
    if(first){
      for(const c of elModelBar.querySelectorAll('.chip')) c.classList.remove('active');
      first.classList.add('active');
    }

    applyFilters();
  });

  // 차종 필터
  elModelBar.addEventListener('click', (e)=>{
    const chip = e.target.closest('.chip');
    if(!chip) return;
    modelFilter = chip.dataset.model;
    for(const c of elModelBar.querySelectorAll('.chip')) c.classList.toggle('active', c===chip);
    applyFilters();
  });

  elQ.addEventListener('input', ()=>{
    applyFilters();
  });

  const toggleBtn = document.getElementById('toggleModels');
  let modelsCollapsed = (window.innerWidth <= 720);
  function renderModelVisibility(){
    elModelBar.style.display = modelsCollapsed ? 'none' : 'flex';
    toggleBtn.textContent = modelsCollapsed ? '펼치기' : '접기';
  }
  toggleBtn.addEventListener('click', ()=>{
    modelsCollapsed = !modelsCollapsed;
    renderModelVisibility();
  });
  window.addEventListener('resize', ()=>{
    if(window.innerWidth <= 720) { modelsCollapsed = true; }
    renderModelVisibility();
  });
  renderModelVisibility();

  // 초기 로드
  loadAll();
</script>
</body>
</html>
